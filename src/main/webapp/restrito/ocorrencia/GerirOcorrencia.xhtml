<ui:composition template="/WEB-INF/template/LayoutPadrao.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="corpo">

		
		<!-- COMEÇA AQUUIIIIIIIIIIIIIIIIIIII -->
		<h:form id="frmPesquisa">

			<p:messages id="messages" showDetail="false" closable="true">
				<p:autoUpdate />
			</p:messages>

			<p:dataTable id="pendenciasTable"
				value="#{respostaOcorrenciaBean.ocorrencias}" var="ocorrencia"
				style="margin-top: 20px"
				emptyMessage="Nenhuma ocorrencia encontrada." rows="10"
				paginator="true" paginatorAlwaysVisible="false"
				paginatorPosition="bottom" lazy="false"
				rowsPerPageTemplate="5,10,15">


				<p:column headerText="Descrição"
					style="width: 200px; text-align: center">
					<h:outputText value="#{ocorrencia.descricao}" />
				</p:column>
				<p:column headerText="Criado por"
					style="width: 200px; text-align: center">
					<h:outputText value="#{ocorrencia.remetente.nome}" />
				</p:column>
				<p:column headerText="Destinatario"
					style="width: 200px; text-align: center">
					<h:outputText value="#{ocorrencia.destinatario.nome}" />
				</p:column>

				<p:column headerText="Status"
					style="width: 200px; text-align: center">
					<h:outputText value="#{ocorrencia.status}" />
				</p:column>


				<p:column style="width: 60px; text-align: center">
					<p:commandButton value="responder" title="Responder"
						action="#{respostaOcorrenciaBean.carregarOcorrencia}"
						update="ocorrenciaDialog"
						oncomplete="PF('ocorrenciaDialog').show()">
						<f:setPropertyActionListener
							target="#{respostaOcorrenciaBean.ocorrencia}"
							value="#{ocorrencia}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>
		</h:form>





		<!-- COMEÇA AQUUIIIIIIIIIIIIIIIIIIII -->



		<p:dialog header="Detalhes da Ocorrência" widgetVar="ocorrenciaDialog"
			modal="true" resizable="false" draggable="false"
			id="ocorrenciaDialog" width="600" showEffect="fade" hideEffect="fade"
			closable="true">
			<h:form>
				<h:panelGroup id="ocorrenciaDetalhes" styleClass="p-3">


					<p:panelGrid columns="2" styleClass="p-grid">
						<h:outputText value="Tipo: " styleClass="ui-font-bold" />
						<h:outputText value="#{respostaOcorrenciaBean.ocorrencia.tipo}" />
						<h:outputText value="Status: " styleClass="ui-font-bold" />
						<h:outputText value="#{respostaOcorrenciaBean.ocorrencia.status}" />
						<h:outputText value="Descrição: " styleClass="ui-font-bold" />
						<h:outputText
							value="#{respostaOcorrenciaBean.ocorrencia.descricao}"
							styleClass="ui-font-italic ui-text-primary" />
					</p:panelGrid>
				</h:panelGroup>


				<h:panelGroup id="respostasPanel" styleClass="p-3">
					<p:panel styleClass="p-mb-3" header="Respostas" toggleable="true">

						<h:outputText value="Não há respostas para esta ocorrência."
							rendered="#{empty respostaOcorrenciaBean.respostas}"
							style="font-weight: bold; color: #ff4c4c; padding: 10px;" />


						<h:panelGroup
							rendered="#{not empty respostaOcorrenciaBean.respostas}">
							<p:panel style="max-height: 300px; overflow-y: auto;">
								<ui:repeat value="#{respostaOcorrenciaBean.respostas}"
									var="resposta">
									<h:outputText
										value="#{resposta.usuario.nome} (#{resposta.usuario.grupo}): " />
									<p:card styleClass="p-shadow-2 p-mb-2"
										style="border: 1px solid #c1c1c1; border-radius: 8px; min-height: 20px; max-height: 200px; overflow-y: auto; word-wrap: break-word;">
										<h:outputText value="#{resposta.resposta}"
											styleClass="ui-text-muted " />

									</p:card>
									<br />
								</ui:repeat>
							</p:panel>
						</h:panelGroup>
					</p:panel>
				</h:panelGroup>

				<p:commandButton value="Responder"
					oncomplete="PF('respostaDialog').show()" />
			</h:form>
		</p:dialog>

		<p:dialog header="Responder" widgetVar="respostaDialog" modal="true"
			resizable="false" draggable="false" id="respostaDialog" width="400">
			<h:form id="formResposta">

				<p:messages id="messages" showDetail="false" closable="true">
					<p:autoUpdate />
				</p:messages>
				<br />
				<p:inputTextarea id="descricaoResposta"
					value="#{respostaOcorrenciaBean.novaResposta.resposta}" rows="5"
					cols="30" required="true" />
				<br />
				<p:commandButton value="Enviar Resposta"
					action="#{respostaOcorrenciaBean.salvarResposta}"
					update="ocorrenciaDialog" oncomplete="PF('respostaDialog').hide()" />
			</h:form>
		</p:dialog>
	</ui:define>

</ui:composition>
